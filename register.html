<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - TES Real Estate</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="page-wrapper" style="padding-bottom: 0;">
        <div class="content-area" style="max-width: 500px; margin: 0 auto; padding-top: 2rem;">
            <!-- Logo -->
            <div class="logo-container">
                <div class="logo-circle"></div>
                <div class="logo-text">TES REAL ESTATE</div>
            </div>
            
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 0.5rem;">Create Account</h2>
                <p class="text-gray text-center" style="margin-bottom: 2rem;">
                    Join TES Real Estate today
                </p>
                
                <!-- Role Selection -->
                <div class="form-group">
                    <label class="form-label">I want to register as</label>
                    <div class="role-selector">
                        <button type="button" class="role-btn active" data-role="customer">
                            üë§<br>Customer
                        </button>
                        <button type="button" class="role-btn" data-role="agent">
                            üë®‚Äçüíº<br>Agent
                        </button>
                    </div>
                </div>
                
                <!-- Registration Form -->
                <form id="registerForm">
                    <div class="form-group">
                        <label for="name" class="form-label">Full Name</label>
                        <input 
                            type="text" 
                            id="name" 
                            class="form-control" 
                            placeholder="Enter your full name"
                            required
                        >
                        <div class="form-error">Please enter your name</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input 
                            type="email" 
                            id="email" 
                            class="form-control" 
                            placeholder="Enter your email"
                            required
                        >
                        <div class="form-error">Please enter a valid email</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            class="form-control" 
                            placeholder="09XXXXXXXXX"
                            required
                        >
                        <div class="form-error">Please enter a valid phone number (10-11 digits)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <input 
                            type="password" 
                            id="password" 
                            class="form-control" 
                            placeholder="At least 8 characters"
                            required
                        >
                        <div class="form-error">Password must be at least 8 characters with 1 uppercase and 1 number</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            class="form-control" 
                            placeholder="Re-enter your password"
                            required
                        >
                        <div class="form-error">Passwords do not match</div>
                    </div>
                    
                    <!-- Customer-specific fields -->
                    <div id="customerFields">
                        <div class="form-group">
                            <label for="address" class="form-label">Address (Optional)</label>
                            <input 
                                type="text" 
                                id="address" 
                                class="form-control" 
                                placeholder="Enter your address"
                            >
                        </div>
                    </div>
                    
                    <!-- Agent-specific fields -->
                    <div id="agentFields" class="hidden">
                        <div class="form-group">
                            <label for="license" class="form-label">License Number</label>
                            <input 
                                type="text" 
                                id="license" 
                                class="form-control" 
                                placeholder="REA-YYYY-XXXX"
                            >
                            <div class="form-error">Please enter your license number</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="agency" class="form-label">Agency Name</label>
                            <input 
                                type="text" 
                                id="agency" 
                                class="form-control" 
                                placeholder="Enter your agency name"
                            >
                            <div class="form-error">Please enter your agency name</div>
                        </div>
                        
                        <div class="info-box">
                            <small>
                                ‚ÑπÔ∏è Your agent account will be pending approval. 
                                You'll be notified once approved.
                            </small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">
                        Create Account
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #E5E7EB;">
                    <p class="text-gray text-sm">
                        Already have an account? 
                        <a href="/login.html" class="text-gold font-bold">Sign In</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/js/utils.js"></script>
    <script src="/js/data.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        // Role selection
        let selectedRole = 'customer';
        const roleButtons = document.querySelectorAll('.role-btn');
        const customerFields = document.getElementById('customerFields');
        const agentFields = document.getElementById('agentFields');
        
        roleButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                roleButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedRole = btn.dataset.role;
                
                // Toggle role-specific fields
                if (selectedRole === 'agent') {
                    customerFields.classList.add('hidden');
                    agentFields.classList.remove('hidden');
                } else {
                    customerFields.classList.remove('hidden');
                    agentFields.classList.add('hidden');
                }
            });
        });
        
        // Form submission
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate inputs
            if (!name) {
                showError(document.getElementById('name'), 'Please enter your name');
                return;
            }
            
            if (!validateEmail(email)) {
                showError(document.getElementById('email'), 'Please enter a valid email');
                return;
            }
            
            if (!validatePhone(phone)) {
                showError(document.getElementById('phone'), 'Please enter a valid phone number (10-11 digits)');
                return;
            }
            
            if (!validatePassword(password)) {
                showError(document.getElementById('password'), 'Password must be at least 8 characters with 1 uppercase and 1 number');
                return;
            }
            
            if (password !== confirmPassword) {
                showError(document.getElementById('confirmPassword'), 'Passwords do not match');
                return;
            }
            
            // Prepare user data
            const userData = {
                name,
                email,
                phone,
                password,
                role: selectedRole
            };
            
            // Add role-specific data
            if (selectedRole === 'agent') {
                const license = document.getElementById('license').value.trim();
                const agency = document.getElementById('agency').value.trim();
                
                if (!license) {
                    showError(document.getElementById('license'), 'Please enter your license number');
                    return;
                }
                
                if (!agency) {
                    showError(document.getElementById('agency'), 'Please enter your agency name');
                    return;
                }
                
                userData.license = license;
                userData.agency = agency;
            } else {
                userData.address = document.getElementById('address').value.trim();
            }
            
            // Attempt registration
            const result = register(userData);
            
            if (result.success) {
                showSuccessAlert('Account created successfully!');
                
                // Redirect to login after 1.5 seconds
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 1500);
            } else {
                showErrorAlert(result.message);
            }
        });
        
        // Clear errors on input
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('input', () => {
                hideError(input);
            });
        });
        
        // Check if already logged in
        const currentUser = getCurrentUser();
        if (currentUser) {
            redirectToDashboard(currentUser.role);
        }
    </script>
</body>
</html>
